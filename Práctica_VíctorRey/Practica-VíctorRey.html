<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>practica-víctorrey</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="Practica-VíctorRey_files/libs/clipboard/clipboard.min.js"></script>
<script src="Practica-VíctorRey_files/libs/quarto-html/quarto.js"></script>
<script src="Practica-VíctorRey_files/libs/quarto-html/popper.min.js"></script>
<script src="Practica-VíctorRey_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Practica-VíctorRey_files/libs/quarto-html/anchor.min.js"></script>
<link href="Practica-VíctorRey_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Practica-VíctorRey_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Practica-VíctorRey_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Practica-VíctorRey_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Practica-VíctorRey_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<p>Vasmos a cargar el dataset de AirBnB descargado de <a href="https://public.opendatasoft.com/explore/dataset/airbnb-listings/export/?disjunctive.host_verifications&amp;disjunctive.amenities&amp;disjunctive.features&amp;q=Madrid&amp;dataChart=eyJxdWVyaWVzIjpbeyJjaGFydHMiOlt7InR5cGUiOiJjb2x1bW4iLCJmdW5jIjoiQ09VTlQiLCJ5QXhpcyI6Imhvc3RfbGlzdGluZ3NfY291bnQiLCJzY2llbnRpZmljRGlzcGxheSI6dHJ1ZSwiY29sb3IiOiJyYW5nZS1jdXN0b20ifV0sInhBeGlzIjoiY2l0eSIsIm1heHBvaW50cyI6IiIsInRpbWVzY2FsZSI6IiIsInNvcnQiOiIiLCJzZXJpZXNCcmVha2Rvd24iOiJyb29tX3R5cGUiLCJjb25maWciOnsiZGF0YXNldCI6ImFpcmJuYi1saXN0aW5ncyIsIm9wdGlvbnMiOnsiZGlzanVuY3RpdmUuaG9zdF92ZXJpZmljYXRpb25zIjp0cnVlLCJkaXNqdW5jdGl2ZS5hbWVuaXRpZXMiOnRydWUsImRpc2p1bmN0aXZlLmZlYXR1cmVzIjp0cnVlfX19XSwidGltZXNjYWxlIjoiIiwiZGlzcGxheUxlZ2VuZCI6dHJ1ZSwiYWxpZ25Nb250aCI6dHJ1ZX0%3D&amp;location=16,41.38377,2.15774&amp;basemap=jawg.streets">aquí</a></p>
<p><img src="descargar.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>airbnb<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">'C:/Users/Victor/Desktop/Práctica data-mining/airbnb-listings.csv'</span>,<span class="at">sep =</span> <span class="st">';'</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">repr.plot.height=</span><span class="dv">4</span>,<span class="at">repr.plot.width=</span><span class="dv">6</span>,<span class="at">repr.plot.res =</span> <span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>Vamos a quedarnos con las columnas de mayor interés: ‘City’,‘Room.Type’,‘Neighbourhood’,‘Accommodates’,‘Bathrooms’,‘Bedrooms’,‘Beds’,‘Price’,‘Square.Feet’,‘Guests.Included’,‘Extra.People’,‘Review.Scores.Rating’,‘Latitude’, ‘Longitude’ Nos quedarmos solo con las entradas de Madrid para Room.Type==“Entire home/apt” y cuyo barrio (Neighbourhood) no está vacio ’’ Podemos eliminar las siguientes columnas que ya no son necesarias: “Room.Type”,‘City’ Llama a nuevo dataframe df_madrid.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>airbnb_n <span class="ot">&lt;-</span> airbnb[,<span class="fu">c</span>(<span class="st">'City'</span>,<span class="st">'Room.Type'</span>,<span class="st">'Neighbourhood'</span>,<span class="st">'Accommodates'</span>,<span class="st">'Bathrooms'</span>,<span class="st">'Bedrooms'</span>,<span class="st">'Beds'</span>,<span class="st">'Price'</span>,<span class="st">'Square.Feet'</span>,<span class="st">'Guests.Included'</span>,<span class="st">'Extra.People'</span>,<span class="st">'Review.Scores.Rating'</span>,<span class="st">'Latitude'</span>, <span class="st">'Longitude'</span>)]</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>airbnb_n <span class="ot">&lt;-</span> airbnb_n[<span class="fu">which</span>(airbnb_n<span class="sc">$</span>City <span class="sc">==</span> <span class="st">"Madrid"</span> <span class="sc">&amp;</span> airbnb_n<span class="sc">$</span>Room.Type <span class="sc">==</span> <span class="st">"Entire home/apt"</span> <span class="sc">&amp;</span> airbnb_n<span class="sc">$</span>Neighbourhood <span class="sc">!=</span> <span class="st">""</span>),]</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>airbnb_n<span class="sc">$</span>Room.Type <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>airbnb_n<span class="sc">$</span>Room.City <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ol start="2" type="1">
<li>Crea una nueva columna llamada Square.Meters a partir de Square.Feet. Recuerda que un pie cuadrado son 0.092903 metros cuadrados.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>airbnb_n[<span class="st">"Square.Meters"</span>] <span class="ot">&lt;-</span> airbnb_n<span class="sc">$</span>Square.Feet <span class="sc">*</span> <span class="fl">0.092903</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ol start="3" type="1">
<li>¿Que porcentaje de los apartamentos no muestran los metros cuadrados? Es decir, ¿cuantos tienen NA en Square.Meters?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"El total de apartamentos con NA en la columna SquareMeters es de"</span>, <span class="fu">sum</span>(<span class="fu">is.na</span>(airbnb_n<span class="sc">$</span>Square.Meters)), <span class="st">"sobre un total de"</span>, <span class="fu">nrow</span>(airbnb_n), <span class="st">"registros, lo que supone un porcentaje de NA's del"</span>, (<span class="fu">sum</span>(<span class="fu">is.na</span>(airbnb_n<span class="sc">$</span>Square.Meters))<span class="sc">/</span><span class="fu">nrow</span>(airbnb_n))<span class="sc">*</span><span class="dv">100</span>, <span class="st">"% en la columna SquareMeters"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "El total de apartamentos con NA en la columna SquareMeters es de 5254 sobre un total de 5601 registros, lo que supone un porcentaje de NA's del 93.8046777361185 % en la columna SquareMeters"</code></pre>
</div>
</div>
<hr>
<ol start="4" type="1">
<li>De todos los apartamentos que tienen un valor de metros cuadrados diferente de NA ¿Que porcentaje de los apartamentos tienen 0 metros cuadrados?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>metros_0 <span class="ot">&lt;-</span> <span class="fu">length</span>(airbnb_n[<span class="fu">which</span>(airbnb_n<span class="sc">$</span>Square.Meters<span class="sc">==</span><span class="dv">0</span>),])</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>sum_no_na <span class="ot">&lt;-</span> <span class="fu">nrow</span>(airbnb_n) <span class="sc">-</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(airbnb_n<span class="sc">$</span>Square.Meters)) </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"El total de apartamentos con valor 0 en la columna SquareMeters es de"</span>, metros_0, <span class="st">"sobre un total de"</span>, sum_no_na, <span class="st">"registros con un valor disinto de NA, lo que supone un porcentaje de 0's del"</span>, (metros_0<span class="sc">/</span>sum_no_na)<span class="sc">*</span><span class="dv">100</span>, <span class="st">"% sobre el total de registros distintos de NA en la columna SquareMeters"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "El total de apartamentos con valor 0 en la columna SquareMeters es de 14 sobre un total de 347 registros con un valor disinto de NA, lo que supone un porcentaje de 0's del 4.03458213256484 % sobre el total de registros distintos de NA en la columna SquareMeters"</code></pre>
</div>
</div>
<hr>
<ol start="5" type="1">
<li>Reemplazar todos los 0m^2 por NA</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>airbnb_n<span class="sc">$</span>Square.Meters[<span class="fu">which</span>(airbnb_n<span class="sc">$</span>Square.Meters <span class="sc">==</span> <span class="dv">0</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Hay muchos NAs, vamos a intentar crear un modelo que nos prediga cuantos son los metros cuadrados en función del resto de variables para tratar de rellenar esos NA. Pero <strong>antes de crear el modelo</strong> vamos a hacer: * pintar el histograma de los metros cuadrados y ver si tenemos que filtrar algún elemento más. * crear una variable sintética nueva basada en la similitud entre barrios que usaremos en nuestro modelo.</p>
<ol start="6" type="1">
<li>Pinta el histograma de los metros cuadrados y ver si tenemos que filtrar algún elemento más</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(airbnb_n<span class="sc">$</span>Square.Meters)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practica-VíctorRey_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<ol start="7" type="1">
<li>Asigna el valor NA a la columna Square.Meters de los apartamentos que tengan menos de 20 m^2</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>airbnb_n<span class="sc">$</span>Square.Meters[<span class="fu">which</span>(airbnb_n<span class="sc">$</span>Square.Meters <span class="sc">&lt;</span> <span class="dv">20</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ol start="8" type="1">
<li>Existen varios Barrios que todas sus entradas de Square.Meters son NA, vamos a eliminar del dataset todos los pisos que pertenecen a estos barrios.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>airbnb_n<span class="sc">$</span>is_na_square <span class="ot">&lt;-</span> <span class="fu">is.na</span>(airbnb_n<span class="sc">$</span>Square.Feet)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>airbnb_n<span class="sc">$</span>is_na_square[<span class="fu">which</span>(airbnb_n<span class="sc">$</span>is_na_square <span class="sc">==</span> <span class="cn">TRUE</span>)] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>registros_barrio <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(airbnb_n<span class="sc">$</span>Neighbourhood, <span class="at">by =</span> <span class="fu">list</span>(airbnb_n<span class="sc">$</span>Neighbourhood), length)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>squaremeters_na_barrio <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(airbnb_n<span class="sc">$</span>is_na_square, <span class="fu">list</span>(airbnb_n<span class="sc">$</span>Neighbourhood), sum)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(registros_barrio) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Barrio"</span>, <span class="st">"Registros"</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(squaremeters_na_barrio) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Barrio"</span>, <span class="st">"na_Metros_Cuadrados"</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>comparativa_registros_metros2 <span class="ot">&lt;-</span> <span class="fu">merge</span>(registros_barrio,squaremeters_na_barrio)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>todos_metros2na <span class="ot">&lt;-</span> comparativa_registros_metros2[<span class="fu">which</span>(comparativa_registros_metros2<span class="sc">$</span>Registros <span class="sc">==</span> comparativa_registros_metros2<span class="sc">$</span>na_Metros_Cuadrados),]</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>barrios_delete <span class="ot">&lt;-</span> todos_metros2na<span class="sc">$</span>Barrio</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>barrios_delete</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Arganzuela"          "Atocha"              "Bellas Vistas"      
 [4] "Berruguete"          "Castillejos"         "Fuencarral-el Pardo"
 [7] "Guindalera"          "Hispanoamérica"      "Ibiza"              
[10] "Imperial"            "La Chopera"          "Moncloa"            
[13] "Prosperidad"         "Tetuán"              "Valdeacederas"      
[16] "Vallehermosa"        "Villa de Vallecas"  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (barrio <span class="cf">in</span> barrios_delete) {</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  airbnb_n <span class="ot">&lt;-</span> airbnb_n[airbnb_n<span class="sc">$</span>Neighbourhood <span class="sc">!=</span> barrio, ]</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>df_madrid <span class="ot">&lt;-</span> airbnb_n</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>El barrio parece ser un indicador importante para los metros cuadrados de un apartamento.</p>
<p>Vamos a agrupar los barrios por metros cuadrados. Podemos usar una matriz de similaridad de Tukey tal y como hicimos en el curso de estadística:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>tky<span class="ot">&lt;-</span><span class="fu">TukeyHSD</span>(<span class="fu">aov</span>( <span class="at">formula=</span>Square.Meters<span class="sc">~</span>Neighbourhood, <span class="at">data=</span>df_madrid ))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>tky.result<span class="ot">&lt;-</span><span class="fu">data.frame</span>(tky<span class="sc">$</span>Neighbourhood)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>cn <span class="ot">&lt;-</span><span class="fu">sort</span>(<span class="fu">unique</span>(df_madrid<span class="sc">$</span>Neighbourhood))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>resm <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="fu">length</span>(cn),<span class="fu">length</span>(cn))</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(resm) <span class="ot">&lt;-</span> cn</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(resm) <span class="ot">&lt;-</span> cn</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>resm[<span class="fu">lower.tri</span>(resm) ] <span class="ot">&lt;-</span> <span class="fu">round</span>(tky.result<span class="sc">$</span>p.adj,<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in resm[lower.tri(resm)] &lt;- round(tky.result$p.adj, 4): número de items
para para sustituir no es un múltiplo de la longitud del reemplazo</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>resm[<span class="fu">upper.tri</span>(resm) ] <span class="ot">&lt;-</span> <span class="fu">t</span>(resm)[<span class="fu">upper.tri</span>(resm)] </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(resm) <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>dfResm <span class="ot">&lt;-</span> <span class="fu">melt</span>(resm)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfResm, <span class="fu">aes</span>(<span class="at">x=</span>Var1, <span class="at">y=</span>Var2, <span class="at">fill=</span>value))<span class="sc">+</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">colour =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"white"</span>,<span class="at">high =</span> <span class="st">"steelblue"</span>)<span class="sc">+</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Class"</span>)<span class="sc">+</span><span class="fu">xlab</span>(<span class="st">"Class"</span>)<span class="sc">+</span><span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>),<span class="at">legend.position=</span><span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practica-VíctorRey_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ol start="9" type="1">
<li>Usando como variable de distancia: 1-resm Dibuja un dendrograma de los diferentes barrios.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dendextend)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
---------------------
Welcome to dendextend version 1.17.1
Type citation('dendextend') for how to cite the package.

Type browseVignettes(package = 'dendextend') for the package vignette.
The github page is: https://github.com/talgalili/dendextend/

Suggestions and bug-reports can be submitted at: https://github.com/talgalili/dendextend/issues
You may ask questions at stackoverflow, use the r and dendextend tags: 
     https://stackoverflow.com/questions/tagged/dendextend

    To suppress this message use:  suppressPackageStartupMessages(library(dendextend))
---------------------</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dendextend'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    cutree</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">dist</span>(<span class="fu">as.dist</span>(<span class="dv">1</span><span class="sc">-</span>resm),<span class="at">method =</span> <span class="st">"euclidean"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>hc <span class="ot">&lt;-</span> <span class="fu">hclust</span>(d,<span class="at">method=</span><span class="st">"complete"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>hcd <span class="ot">&lt;-</span> <span class="fu">as.dendrogram</span>(hc)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(hcd)</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(color_branches(hcd, h=2.7))</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">color_branches</span>(hcd, <span class="at">h=</span><span class="fl">2.3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practica-VíctorRey_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<ol start="10" type="1">
<li>¿Que punto de corte sería el aconsejable?, ¿cuantos clusters aparecen?</li>
</ol>
<p>Por simplicidad, el corte podría fijarse en 2.7 resultando 3 clústers, uno de ellos de gran tamaño que agruparía a la mayoría de los barrios.</p>
<p>Si no queremos un clúster tan grande, podríamos fijar el corte en 2.3, resultando 8 clústers.</p>
<hr>
<ol start="11" type="1">
<li>Vamos a crear una nueva columna en el dataframe df_madrid con un nuevo identificador marcado por los clusters obtenidos. Esta columna la llamaremos neighb_id</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>clusters_barrios <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cutree</span>(hcd, <span class="at">h=</span><span class="fl">2.3</span>))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>clusters_barrios<span class="sc">$</span>Barrio <span class="ot">&lt;-</span> <span class="fu">rownames</span>(clusters_barrios)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(clusters_barrios) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"neighb_id"</span>, <span class="st">"Neighbourhood"</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>df_madrid <span class="ot">&lt;-</span> <span class="fu">merge</span>(df_madrid, clusters_barrios)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ol start="12" type="1">
<li>Vamos a crear dos grupos, uno test y otro train.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1235</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>idx<span class="ot">&lt;-</span><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df_madrid),<span class="fu">nrow</span>(df_madrid)<span class="sc">*</span><span class="fl">0.7</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>df_madrid.train<span class="ot">&lt;-</span>df_madrid[idx,]</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>df_madrid.test <span class="ot">&lt;-</span>df_madrid[<span class="sc">-</span>idx,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ol start="13" type="1">
<li>Tratamos de predecir los metros cuadrados en función del resto de columnas del dataframe.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>df_madrid.train<span class="sc">$</span>City <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>df_madrid.train<span class="sc">$</span>is_na_square <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>model_dfmadrid<span class="ot">&lt;-</span><span class="fu">lm</span>(Square.Meters<span class="sc">~</span>Accommodates<span class="sc">+</span>Bathrooms<span class="sc">+</span>Bedrooms<span class="sc">+</span>Price<span class="sc">+</span>Guests.Included<span class="sc">+</span>Extra.People<span class="sc">+</span>Review.Scores.Rating,<span class="at">data=</span>df_madrid.train)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_dfmadrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Square.Meters ~ Accommodates + Bathrooms + Bedrooms + 
    Price + Guests.Included + Extra.People + Review.Scores.Rating, 
    data = df_madrid.train)

Residuals:
    Min      1Q  Median      3Q     Max 
-64.274 -12.521  -1.425  10.915 108.607 

Coefficients:
                       Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)          -123.35290   33.30568  -3.704 0.000341 ***
Accommodates            9.67237    2.22080   4.355  3.1e-05 ***
Bathrooms              36.87011    5.27292   6.992  2.6e-10 ***
Bedrooms                4.80636    3.99000   1.205 0.231065    
Price                   0.12486    0.03952   3.159 0.002065 ** 
Guests.Included        -6.94939    2.24760  -3.092 0.002547 ** 
Extra.People            0.53203    0.30298   1.756 0.082006 .  
Review.Scores.Rating    1.03189    0.35378   2.917 0.004325 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 24.21 on 105 degrees of freedom
  (3523 observations deleted due to missingness)
Multiple R-squared:  0.7938,    Adjusted R-squared:  0.7801 
F-statistic: 57.75 on 7 and 105 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df_madrid.test<span class="sc">$</span>sqmeters_est<span class="ot">&lt;-</span><span class="fu">predict</span>(model_dfmadrid,df_madrid.test)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">postResample</span>(<span class="at">pred=</span>df_madrid.test<span class="sc">$</span>sqmeters_est,<span class="at">obs=</span>df_madrid.test<span class="sc">$</span>Square.Meters)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
       NA 0.5192362        NA </code></pre>
</div>
</div>
<hr>
<ol start="14" type="1">
<li>Mirad el histograma de los residuos sobre el conjunto de test para evaluar la calidad de vuestro modelo</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(df_madrid.test<span class="sc">$</span>Square.Meters<span class="sc">-</span>df_madrid.test<span class="sc">$</span>sqmeters_est)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practica-VíctorRey_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Una calidad justita, los errores son considerables, la mayoría en la horquilla -(20) - (+40).</p>
<hr>
<ol start="15" type="1">
<li>Si tuvieramos un anuncio de un apartamento para 6 personas (Accommodates), con 1 baño, con un precio de 80€/noche y 3 habitaciones en el barrio de Sol, con 3 camas y un review de 80. ¿Cuantos metros cuadrados tendría? Si tu modelo necesita algúna variable adicional puedes inventartela dentro del rango de valores del dataset. ¿Como varía sus metros cuadrados con cada habitación adicional?</li>
</ol>
<p>Mi modelo no usa los barrios en la regresión lineal por lo comentado en el chat de Discord: hay barrios que no ve en el training pero sí en el testing y en esos casos no sabe qué coeficientes aplicar.</p>
<p>A continuación calculo un nuevo modelo con las variables que figuran en el enunciado.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>model_dfmadrid15<span class="ot">&lt;-</span><span class="fu">lm</span>(Square.Meters<span class="sc">~</span>Accommodates<span class="sc">+</span>Bathrooms<span class="sc">+</span>Bedrooms<span class="sc">+</span>Price<span class="sc">+</span>Beds<span class="sc">+</span>Review.Scores.Rating<span class="sc">+</span>Neighbourhood,<span class="at">data=</span>df_madrid.train)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_dfmadrid15)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Square.Meters ~ Accommodates + Bathrooms + Bedrooms + 
    Price + Beds + Review.Scores.Rating + Neighbourhood, data = df_madrid.train)

Residuals:
    Min      1Q  Median      3Q     Max 
-77.529  -7.916   0.000   7.814  77.529 

Coefficients:
                               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                  -162.41564   44.55133  -3.646 0.000483 ***
Accommodates                    4.54784    2.76819   1.643 0.104482    
Bathrooms                      29.95364    7.63887   3.921 0.000190 ***
Bedrooms                        8.70447    5.54459   1.570 0.120538    
Price                           0.06832    0.04459   1.532 0.129535    
Beds                            4.47667    3.19237   1.402 0.164844    
Review.Scores.Rating            1.85676    0.44584   4.165 8.07e-05 ***
NeighbourhoodAdelfas          -62.74930   30.70939  -2.043 0.044441 *  
NeighbourhoodAlmagro          -29.35115   29.58232  -0.992 0.324215    
NeighbourhoodAlmenara          11.70960   21.40426   0.547 0.585914    
NeighbourhoodArapiles         -51.05233   29.73880  -1.717 0.090056 .  
NeighbourhoodCarabanchel       -9.04009   24.53660  -0.368 0.713562    
NeighbourhoodCastilla         -31.89325   24.72818  -1.290 0.200997    
NeighbourhoodCentro           -29.99442   29.93634  -1.002 0.319511    
NeighbourhoodCiudad Jardin     -7.19209   29.90604  -0.240 0.810590    
NeighbourhoodCiudad Lineal    -31.88654   30.71246  -1.038 0.302413    
NeighbourhoodCortes           -35.13612   20.88448  -1.682 0.096542 .  
NeighbourhoodCuatro Caminos   -56.47848   24.96049  -2.263 0.026472 *  
NeighbourhoodEl Viso          -19.61702   29.74064  -0.660 0.511477    
NeighbourhoodEmbajadores      -31.03716   18.53481  -1.675 0.098083 .  
NeighbourhoodGoya             -42.95051   30.14061  -1.425 0.158197    
NeighbourhoodJerónimos         33.76431   28.73492   1.175 0.243605    
NeighbourhoodJusticia         -35.00915   19.96910  -1.753 0.083553 .  
NeighbourhoodLa Latina        -37.91140   18.54065  -2.045 0.044295 *  
NeighbourhoodLista            -69.54611   26.42173  -2.632 0.010247 *  
NeighbourhoodMalasaña         -30.11616   18.39580  -1.637 0.105686    
NeighbourhoodMoratalaz        -46.16378   31.33402  -1.473 0.144752    
NeighbourhoodPacifico         -19.39724   29.99425  -0.647 0.519750    
NeighbourhoodPalacio          -30.45237   22.53147  -1.352 0.180477    
NeighbourhoodPalos do Moguer  -23.22770   30.18996  -0.769 0.444019    
NeighbourhoodRecoletos        -30.15289   24.70161  -1.221 0.225930    
NeighbourhoodRetiro           -48.33838   30.67949  -1.576 0.119220    
NeighbourhoodRios Rosas        -0.81450   37.86867  -0.022 0.982896    
NeighbourhoodSan Blas         -19.72887   24.71559  -0.798 0.427189    
NeighbourhoodSol              -18.42229   18.16089  -1.014 0.313572    
NeighbourhoodTrafalgar        -31.00749   22.65080  -1.369 0.175000    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 24.06 on 77 degrees of freedom
  (3523 observations deleted due to missingness)
Multiple R-squared:  0.8506,    Adjusted R-squared:  0.7827 
F-statistic: 12.53 on 35 and 77 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>metros_cuadrados_enunciado <span class="ot">&lt;-</span>  <span class="sc">-</span><span class="fl">162.41</span> <span class="sc">+</span> (<span class="dv">6</span> <span class="sc">*</span> <span class="fl">4.54</span>) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">*</span> <span class="fl">29.95</span>) <span class="sc">+</span> (<span class="dv">80</span> <span class="sc">*</span> <span class="fl">0.068</span>) <span class="sc">+</span> (<span class="dv">3</span> <span class="sc">*</span> <span class="fl">8.70</span>) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">*</span> (<span class="sc">-</span><span class="fl">18.42</span>)) <span class="sc">+</span> (<span class="dv">3</span> <span class="sc">*</span> <span class="fl">4.47</span>) <span class="sc">+</span> (<span class="dv">80</span> <span class="sc">*</span> <span class="fl">1.85</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"El apartamento tendrá un tamaño predicho de"</span>, metros_cuadrados_enunciado, <span class="st">"metros cuadrados"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "El apartamento tendrá un tamaño predicho de 69.31 metros cuadrados"</code></pre>
</div>
</div>
<hr>
<ol start="16" type="1">
<li>Rellenar los Square.Meters con valor NA con el estimado con el modelo anterior.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>df_madrid<span class="sc">$</span>Square.Meters[<span class="fu">which</span>(<span class="fu">is.na</span>(df_madrid<span class="sc">$</span>Square.Meters))] <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_dfmadrid,df_madrid[<span class="fu">which</span>(<span class="fu">is.na</span>(df_madrid<span class="sc">$</span>Square.Meters)),])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ol start="17" type="1">
<li><p>Usar PCA para encontrar el apartamento más cercano a uno dado. Este algoritmo nos ayudaría a dado un apartamento que el algoritmo nos devolvería los 5 apartamentos más similares.</p>
<p>Crearemos una función tal que le pasemos un apartamento con los siguientes datos: * Accommodates * Bathrooms * Bedrooms * Beds * Price * Guests.Included * Extra.People * Review.Scores.Rating * Latitude * Longitude * Square.Meters y nos devuelva los 5 más similares de:</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>df_madrid_pca <span class="ot">&lt;-</span> df_madrid[, <span class="fu">c</span>(<span class="st">"Accommodates"</span>, <span class="st">"Bathrooms"</span>,  <span class="st">"Bedrooms"</span>,  <span class="st">"Beds"</span>, <span class="st">"Price"</span>, <span class="st">"Guests.Included"</span>, <span class="st">"Extra.People"</span>, <span class="st">"Review.Scores.Rating"</span>, <span class="st">"Latitude"</span>, <span class="st">"Longitude"</span>, <span class="st">"Square.Meters"</span>)]</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>df_madrid_pca <span class="ot">&lt;-</span> df_madrid_pca[<span class="fu">complete.cases</span>(df_madrid_pca),]</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>pca_madrid<span class="ot">&lt;-</span><span class="fu">prcomp</span>(df_madrid_pca, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pca_madrid<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="fu">sum</span>(pca_madrid<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>),<span class="at">main=</span><span class="st">"Autovalores"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practica-VíctorRey_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"Nos quedamos con los primeros 4 componentes principales, que explicarían en torno al 80% de la varianza"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Nos quedamos con los primeros 4 componentes principales, que explicarían en torno al 80% de la varianza"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>number_of_pca_components <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>knn <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>new_vector <span class="ot">&lt;-</span> df_madrid_pca[<span class="dv">1</span>,]</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>out<span class="ot">&lt;-</span><span class="fu">predict</span>(pca_madrid, <span class="at">newdata =</span> new_vector)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>out<span class="ot">&lt;-</span><span class="fu">matrix</span>(out,<span class="at">nrow=</span><span class="dv">1</span>)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>dist<span class="ot">&lt;-</span><span class="fu">rowSums</span>((out[<span class="fu">rep</span>(<span class="dv">1</span>, <span class="at">times =</span> <span class="fu">nrow</span>(df_madrid_pca)), ]<span class="sc">-</span>df_madrid_pca)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>knn_tags<span class="ot">&lt;-</span><span class="fu">rownames</span>(df_madrid_pca)[<span class="fu">order</span>(dist,<span class="at">decreasing =</span> F) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>knn)]</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>knn_tags</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "651"  "2052" "2166" "2184" "2368"</code></pre>
</div>
</div>
<hr>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>